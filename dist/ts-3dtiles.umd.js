!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).ts3dtils={})}(this,function(t){"use strict";function e(t,e,s){void 0!==s&&Object.defineProperty(t,e,{value:s})}function s(t,e){if(void 0!==e){const s={},i=[...e];i.forEach(t=>{Object.defineProperty(s,t.name,{value:t.json()})}),Object.defineProperty(t,"extensions",{value:s})}}var i;(i=r=r||{}).TWO="2.0",i.ONE="1.0";var r,n=r;class a{constructor(){this.version=n.TWO,this.extensions=new Set}validate(){return!0}json(){var t={version:this.version};return e(t,"generator",this.generator),e(t,"minVersion",this.minVersion),e(t,"copyright",this.copyright),e(t,"extensions",this.generator),e(t,"extras",this.extras),t}}class o{constructor(){this.byteLength=0,this.extensions=new Set}get url(){return this.uri}validate(){return 0<this.byteLength}json(){var t={byteLength:this.byteLength};return e(t,"uri",this.uri),s(t,this.extensions),e(t,"extras",this.extras),t}}(r=h=h||{})[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER";var h,l=h;class u{constructor(){this.buffer=0,this.byteLength=1,this.byteOffset=0,this.byteStride=4,this.extensions=new Set}validate(){return!(this.buffer<0)&&(!(this.byteLength<1)&&(!(this.byteOffset<0)&&!(this.byteStride%4!=0||252<this.byteStride||this.byteStride<4)))}json(){if(!this.validate())throw new Error("[GLTFBufferView json()] 当前 bufferView 属性不合法，请检查");var t={buffer:this.buffer,byteLength:this.byteLength};return this.target!==l.ARRAY_BUFFER&&this.target!==l.ELEMENT_ARRAY_BUFFER||e(t,"target",this.target),e(t,"byteOffset",this.byteOffset),e(t,"byteStride",this.byteStride),s(t,this.extensions),e(t,"extras",this.extras),t}}(h=f=f||{}).OPAQUE="OPAQUE",h.MASK="MASK",h.BLEND="BLEND";var d=f;(f=c=c||{}).SCALAR="SCALAR",f.VEC2="VEC2",f.VEC3="VEC3",f.VEC4="VEC4",f.MAT2="MAT2",f.MAT3="MAT3",f.MAT4="MAT4";var c,f=c;(c=v=v||{})[c.BYTE=5120]="BYTE",c[c.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",c[c.SHORT=5122]="SHORT",c[c.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",c[c.UNSIGNED_INT=5125]="UNSIGNED_INT",c[c.FLOAT=5126]="FLOAT";var g=v;(v=p=p||{})[v.NEAREST=9728]="NEAREST",v[v.LINEAR=9729]="LINEAR",v[v.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",v[v.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",v[v.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",v[v.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR";var v=p;(p=m=m||{})[p.REPEAT=10497]="REPEAT",p[p.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",p[p.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT";var m,p=m;(m=T=T||{})[m.POINTS=0]="POINTS",m[m.LINES=1]="LINES",m[m.LINE_LOOP=2]="LINE_LOOP",m[m.LINE_STRIP=3]="LINE_STRIP",m[m.TRIANGLES=4]="TRIANGLES",m[m.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",m[m.TRIANGLE_FAN=6]="TRIANGLE_FAN";var b=T;(T=A=A||{}).JPG="image/jpg",T.JPEG="image/jpeg",T.PNG="image/png",T.WEBP="image/webp";var T=A;class y{constructor(t){this.position=t.position,this.uv0=t.uv0,this.uv1=t.uv1,this.color0=t.color0,this.normal=t.normal,this.tangent=t.tangent,this.joints0=t.joints0,this.weights0=t.weights0}validate(){return Object.values(this).every(t=>t<0)}json(){var t={POSITION:this.position};return e(t,"NORMAL",this.normal),e(t,"TANGENT",this.tangent),e(t,"TEXCOORD_0",this.uv0),e(t,"TEXCOORD_1",this.uv1),e(t,"COLOR_0",this.color0),e(t,"JOINTS_0",this.joints0),e(t,"WEIGHTS_0",this.weights0),t}}class L{constructor(t,e){this.index=t,this.texCoord=e}validate(){return this.index<0||this.texCoord<0}json(){if(!this.validate())throw new Error("[GLTFTextureInfo json()] 当前 textureinfo 对象属性不合法，请检查");return{index:this.index,texCoord:this.texCoord}}}class E{constructor(){this.asset=new a,this.scene=0,this.buffers=[],this.bufferViews=[],this.accessors=[],this.scenes=[],this.nodes=[],this.meshes=[],this.materials=[],this.textures=[]}json(){var t={asset:this.asset.json(),buffers:this.buffers.map(t=>t.json()),bufferViews:this.bufferViews.map(t=>t.json()),accessors:this.accessors.map(t=>t.json()),scenes:this.scenes.map(t=>t.json()),nodes:this.nodes.map(t=>t.json()),meshes:this.meshes.map(t=>t.json())};e(t,"scene",this.scene),e(t,"materials",void 0!==this.materials&&0!==this.materials.length?this.materials.map(t=>t.json()):void 0),e(t,"textures",void 0!==this.textures&&0!==this.textures.length?this.textures.map(t=>t.json()):void 0),e(t,"images",void 0!==this.images&&0!==this.images.length?this.images.map(t=>t.json()):void 0),e(t,"samplers",void 0!==this.samplers&&0!==this.samplers.length?this.samplers.map(t=>t.json()):void 0),e(t,"cameras",void 0!==this.cameras&&0!==this.cameras.length?this.cameras.map(t=>t.json()):void 0),e(t,"animations",void 0!==this.animations&&0!==this.animations.length?this.animations.map(t=>t.json()):void 0),e(t,"skins",void 0!==this.skins&&0!==this.skins.length?this.skins.map(t=>t.json()):void 0),s(t,this.extensions),e(t,"extras",this.extras),e(t,"extensionsUsed",this.extensionsUsed),e(t,"extensionsRequired",this.extensionsRequired)}}class x{constructor(){this._name=""}get name(){return this._name}get isRequire(){return!1}validate(){return!0}json(){}}const w=(t,...e)=>{const s=new E;e=e.length;console.log(`Resources Length is ${e}`);let i=t;return"string"==typeof t&&(i=JSON.parse(t.trim())),i,s.scene=i.scene,e=s.asset,t=i.asset,e.version="1.0"===t.version?n.ONE:n.TWO,e.minVersion="1.0"===t.minVersion?n.ONE:n.TWO,e.copyright=t.copyright,e.generator=t.generator,e.extras=t.extras,function(t,e){for(const s of e){const i=new o;i.uri=s.uri,i.byteLength=s.byteLength,i.extras=s.extras,t.push(i)}}(s.buffers,i.buffers),function(t,e){for(const s of e){const i=new u;i.buffer=s.buffer,i.byteLength=s.byteLength,i.byteOffset=s.byteOffset,i.extras=s.extras,i.target=s.target,t.push(i)}}(s.bufferViews,i.bufferViews),s};function S(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function O(t,e){return t(e={exports:{}},e.exports),e.exports}function N(t="utf-8"){if("utf-8"!==t)throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${t}') is invalid.`)}function B(t="utf-8",e={fatal:!1}){if("utf-8"!==t)throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${t}') is invalid.`);if(e.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}(A="undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0).TextEncoder&&A.TextDecoder||(Object.defineProperty(N.prototype,"encoding",{value:"utf-8"}),N.prototype.encode=function(e,t={stream:!1}){if(t.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let s=0;var i,r=e.length;let n=0,a=Math.max(32,r+(r>>1)+7),o=new Uint8Array(a>>3<<3);for(;s<r;){let t=e.charCodeAt(s++);if(55296<=t&&t<=56319)if(s<r&&(56320==(64512&(i=e.charCodeAt(s)))&&(++s,t=((1023&t)<<10)+(1023&i)+65536)),55296<=t&&t<=56319)continue;if(n+4>o.length){a+=8,a*=1+s/e.length*2,a=a>>3<<3;const h=new Uint8Array(a);h.set(o),o=h}if(0!=(4294967168&t)){if(0==(4294965248&t))o[n++]=t>>6&31|192;else if(0==(4294901760&t))o[n++]=t>>12&15|224,o[n++]=t>>6&63|128;else{if(0!=(4292870144&t))continue;o[n++]=t>>18&7|240,o[n++]=t>>12&63|128,o[n++]=t>>6&63|128}o[n++]=63&t|128}else o[n++]=t}return o.slice(0,n)},Object.defineProperty(B.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(B.prototype,"fatal",{value:!1}),Object.defineProperty(B.prototype,"ignoreBOM",{value:!1}),B.prototype.decode=function(t,e={stream:!1}){if(e.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");var s=new Uint8Array(t);let i=0;var r=s.length;const n=[];for(;i<r;){var a=s[i++];if(0===a)break;if(0==(128&a))n.push(a);else if(192==(224&a)){var o=63&s[i++];n.push((31&a)<<6|o)}else if(224==(240&a)){var h=63&s[i++],o=63&s[i++];n.push((31&a)<<12|h<<6|o)}else if(240==(248&a)){let t=(7&a)<<18|(63&s[i++])<<12|(63&s[i++])<<6|63&s[i++];65535<t&&(t-=65536,n.push(t>>>10&1023|55296),t=56320|1023&t),n.push(t)}}return String.fromCharCode.apply(null,n)},A.TextEncoder=N,A.TextDecoder=B);var _=O(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.encode=e.decode=void 0;const s=new TextDecoder("utf-8");e.decode=function(t){return s.decode(t)};const i=new TextEncoder;e.encode=function(t){return i.encode(t)}});S(_),_.encode,_.decode;var A=O(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.IOBuffer=void 0;e.IOBuffer=class n{constructor(t=8192,e={}){let s=!1;"number"==typeof t?t=new ArrayBuffer(t):(s=!0,this.lastWrittenByte=t.byteLength);var i=e.offset?e.offset>>>0:0,e=t.byteLength-i;let r=i;(ArrayBuffer.isView(t)||t instanceof n)&&(t.byteLength!==t.buffer.byteLength&&(r=t.byteOffset+i),t=t.buffer),s?this.lastWrittenByte=e:this.lastWrittenByte=0,this.buffer=t,this.length=e,this.byteLength=e,this.byteOffset=r,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,r,e),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){var t=this._marks.pop();if(void 0===t)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){t=2*(this.offset+t);const e=new Uint8Array(t);e.set(new Uint8Array(this.buffer)),this.buffer=e.buffer,this.length=this.byteLength=t,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){const s=new Uint8Array(e);for(let t=0;t<e;t++)s[t]=this.readByte();return s}readInt16(){var t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){var t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){var t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){var t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){var t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){var t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){let s="";for(let t=0;t<e;t++)s+=this.readChar();return s}readUtf8(t=1){return _.decode(this.readBytes(t))}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(e){this.ensureAvailable(e.length);for(let t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(e){for(let t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}writeUtf8(t){return this.writeBytes(_.encode(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}});S(A);var I=A.IOBuffer;class F{}class R{validate(){return!0}}class j extends R{constructor(){super()}}(A=G=G||{}).B3dm="b3dm",A.I3dm="i3dm",A.Pnts="pnts",A.Vctr="vctr";var G,C=G;class U{validate(){return!1}}class P extends U{constructor(){super()}static createFromJSON(t,e){const s=new P;return s._json=t,s._binary=e,s.featureTableType=C.B3dm,t=s,e=t._json,t.batchLength=e.BATCH_LENGTH,t.rtcCenter=e.RTC_CENTER,void 0!==e.extensions&&(t.extensions=new Set),t.extras=e.extras,s}validate(){return void 0!==this.batchLength}}class M{constructor(){this.variables=new Map}static createFromJSON(t,e){const s=new M;return s._json=t,s._binary=e,function(t){for(const e of Object.keys(t._json))t.variables.set(e,t._json[e])}(s),s}validate(){return!0}get variableNames(){return Object.keys(this._json)}get variableCounts(){return this.variableNames.length}getVariable(t){if(this.variables.has(t))return this.variables.get(t);throw new Error(`[BatchTable getVariable()] 没有这个值：${t}。`)}}class V extends R{constructor(){super()}validate(){return 0===this.gltfFormat||1===this.gltfFormat}}class J extends U{constructor(){super()}static createFromJSON(t,e){const s=new J;return s._json=t,s._binary=e,s.featureTableType=C.I3dm,t=s,e=t._json,t.position=e.POSITION,t.positionQuantized=e.POSITION_QUANTIZED,t.normalUp=e.NORMAL_UP,t.normalRight=e.NORMAL_RIGHT,t.normalUpOct32p=e.NORMAL_UP_OCT32P,t.normalRightOct32p=e.NORMAL_RIGHT_OCT32P,t.scale=e.SCALE,t.scaleNonUniform=e.SCALE_NON_UNIFORM,t.instancesLength=e.INSTANCES_LENGTH,t.rtcCenter=e.RTC_CENTER,t.quantizedVolumeOffset=e.QUANTIZED_VOLUME_OFFSET,t.quantizedVolumeScale=e.QUANTIZED_VOLUME_SCALE,void 0!==e.extensions&&(t.extensions=new Set),t.extras=e.extras,s}validate(){return(void 0!==(t=this).position||void 0!==t.positionQuantized)&&((void 0===t.position||void 0===t.positionQuantized)&&((void 0===t.positionQuantized||void 0!==t.quantizedVolumeOffset&&void 0!==t.quantizedVolumeScale)&&(!(void 0===t.normalUp&&void 0!==t.normalRight||void 0===t.normalRight&&void 0!==t.normalUp)&&!(void 0===t.normalUpOct32p&&void 0!==t.normalRightOct32p||void 0===t.normalRightOct32p&&void 0!==t.normalUpOct32p))));var t}}class D extends R{constructor(){super()}}class z extends U{constructor(){super()}static createFromJSON(t,e){const s=new z;return s._json=t,s._binary=e,s.featureTableType=C.Pnts,t=s,e=t._json,t.position=e.POSITION,t.positionQuantized=e.POSITION_QUANTIZED,t.rgba=e.RGBA,t.rgb=e.RGB,t.rgb565=e.RGB565,t.normal=e.NORMAL,t.normalOct16p=e.NORMAL_OCT16P,t.batchId=e.BATCH_ID,t.pointsLength=e.POINTS_LENGTH,t.quantizedVolumeOffset=e.QUANTIZED_VOLUME_OFFSET,t.quantizedVolumeScale=e.QUANTIZED_VOLUME_SCALE,t.constantRgba=e.CONSTANT_RGBA,void 0!==e.extensions&&(t.extensions=new Set),t.extras=e.extras,s}validate(){return(void 0!==(t=this).position||void 0!==t.positionQuantized)&&((void 0===t.batchId||void 0!==t.batchLength)&&(void 0===t.positionQuantized||void 0!==t.quantizedVolumeOffset&&void 0!==t.quantizedVolumeScale));var t}}(G=k=k||{}).ADD="add",G.REPLACE="replace";var k=k;t.Asset=class{validate(){return!0}},t.B3dm=class{constructor(t,e=!1){this.header=new j,function(t,e){const s=new I(e);if(i=t.header,(e=s).rewind(),i.magic=e.readChars(4),i.version=e.readUint32(),i.byteLength=e.readUint32(),i.featureTableJSONByteLength=e.readUint32(),i.featureTableBinaryByteLength=e.readUint32(),i.batchTableJSONByteLength=e.readUint32(),i.batchTableBinaryByteLength=e.readUint32(),t.byteLength%8!=0)throw new Error("[B3dm 实例化错误] byteLength 未 8 字节对齐。");s.rewind(),s.skip(28);var i=JSON.parse(s.readChars(t.featureTableJSONByteLength)),e=s.readBytes(t.featureTableBinaryByteLength);t.featureTable=P.createFromJSON(i,e),0!==t.batchTableJSONByteLength&&(i=JSON.parse(s.readChars(t.batchTableJSONByteLength)),e=s.readBytes(t.batchTableBinaryByteLength),t.batchTable=M.createFromJSON(i,e))}(this,t),!0===e&&(this.buffer=t)}validate(){return!0}get magic(){return this.header.magic}get byteLength(){return this.header.byteLength}get version(){return this.header.version}get featureTableJSONByteLength(){return this.header.featureTableJSONByteLength}get featureTableBinaryByteLength(){return this.header.featureTableBinaryByteLength}get batchTableJSONByteLength(){return this.header.batchTableJSONByteLength}get batchTableBinaryByteLength(){return this.header.batchTableBinaryByteLength}get sizeWithoutGLB(){return 28+this.featureTableJSONByteLength+this.featureTableBinaryByteLength+this.batchTableJSONByteLength+this.batchTableBinaryByteLength}},t.B3dmFeatureTable=P,t.B3dmHeader=j,t.BatchTable=M,t.Cmpt=class{},t.ExtBatchtableHierarchy=class extends F{constructor(){super(...arguments),this.name="3DTILES_batch_table_hierarchy"}load(){}},t.ExtContentGLTF=class extends F{constructor(){super(...arguments),this.name="3DTILES_content_gltf"}},t.ExtDraco=class extends x{constructor(t){super(),this._name="KHR_draco_mesh_compression",this.bufferView=t.bufferView,this.attributes=t.attributes}get isRequire(){return!0}validate(){return Number.isInteger(this.bufferView)}json(){return{name:this._name,bufferView:this.bufferView,attributes:this.attributes.json()}}},t.ExtImplicitTiling=class extends F{constructor(){super(...arguments),this.name="3DTILES_implicit_tiling"}},t.ExtLayers=class extends F{constructor(){super(...arguments),this.name="3DTILES_layers"}},t.ExtMetadata=class extends F{constructor(){super(...arguments),this.name="3DTILES_metadata"}},t.ExtMultipleContent=class extends F{constructor(){super(...arguments),this.name="3DTILES_multiple_contents"}},t.ExtPbrSpecularGlossiness=class extends x{constructor(){super(...arguments),this._name="KHR_materials_pbrSpecularGlossiness"}get isRequire(){return!0}validate(){return!0}json(){return{}}},t.ExtPntsDraco=class extends F{constructor(){super(...arguments),this.name="3DTILES_draco_point_compression"}},t.FeatureTable=U,t.GLTFAccessor=class{constructor(t){this.extensions=new Set,this.componentType=t.componentType,this.count=t.count,this.type=t.type}validate(){return void 0!==this.byteOffset&&void 0!==this.bufferView}json(){if(!this.validate())throw new Error("[GLTFAccessor json()] 当前 accessor 属性不合法，请检查");var t={componentType:this.componentType,type:this.type,count:this.count};return e(t,"max",this.max),e(t,"min",this.min),e(t,"name",this.name),e(t,"normalized",this.normalized),e(t,"sparse",void 0!==this.sparse?this.sparse.json():void 0),e(t,"bufferView",this.bufferView),e(t,"byteOffset",this.byteOffset),s(t,this.extensions),e(t,"extras",this.extras),t}},t.GLTFAccessorSparse=class{validate(){return 0<this.count&&this.values.validate()&&this.indices.validate()}json(){if(!this.validate())throw new Error("[GLTFAccessorSparse json()] 此 sparse 对象属性不合法，请检查属性");return{count:this.count,indices:this.indices.json(),values:this.values.json()}}},t.GLTFAccessorSparseIndices=class{constructor(){this.extensions=new Set}validate(){return this.componentType===g.UNSIGNED_BYTE||this.componentType===g.UNSIGNED_INT||this.componentType===g.UNSIGNED_SHORT}json(){if(!this.validate())throw new Error("[GLTFAccessorSparseIndices json()] 此 accessor.sparse.indices 的属性不合法，请检查");var t={bufferView:this.bufferView,byteOffset:this.byteOffset,componentType:this.componentType};return s(t,this.extensions),e(t,"extras",this.extras),t}},t.GLTFAccessorSparseValues=class{constructor(){this.extensions=new Set}validate(){return!(this.byteOffset<0)}json(){if(!this.validate())throw new Error("[GLTFAccessorSparseValues json()] 此 accessor.sparse.values 的属性不合法，请检查");var t={bufferView:this.bufferView};return e(t,"byteOffset",this.byteOffset),s(t,this.extensions),e(t,"extras",this.extras),t}},t.GLTFAlphaMode=d,t.GLTFAnimation=class{constructor(){this.channels=[],this.samplers=[],this.extensions=new Set}validate(){return!(this.channels.length<1||this.samplers.length<1)}json(){if(!this.validate())throw new Error("[GLTFAnimation json()] 当前 animation 对象属性不合法，请检查");var t={};return e(t,"name",this.name),e(t,"channels",0!==this.channels.length?this.channels.map(t=>t.json()):void 0),e(t,"samplers",0!==this.samplers.length?this.samplers.map(t=>t.json()):void 0),s(t,this.extensions),e(t,"extras",this.extras),t}},t.GLTFAnimationChannel=class{constructor(){this.extensions=new Set}validate(){return this.target.validate()}json(){if(!this.validate())throw new Error("[GLTFAnimationChannel json()] 当前 animation channel 对象的属性不合法，请检查");var t={sampler:this.sampler,target:this.target.json()};return s(t,this.extensions),e(t,"extras",this.extras),t}},t.GLTFAnimationChannelTarget=class{constructor(){this.extensions=new Set}validate(){return!0}json(){var t={path:this.path};return s(t,this.extensions),e(t,"node",this.node),t}},t.GLTFAnimationSampler=class{validate(){return!0}json(){var t={input:this.input,output:this.output};return e(t,"interpolation",this.interpolation),t}},t.GLTFAsset=a,t.GLTFAttributeType=f,t.GLTFBuffer=o,t.GLTFBufferView=u,t.GLTFCamera=class{constructor(t){this.extensions=new Set,this.orthographic=t.orthographic,this.perspective=t.perspective,this.type=t.type,this.name=t.name}validate(){return void 0===this.orthographic||void 0===this.perspective}json(){if(!this.validate())throw new Error("[GLTFCamera json()] 数据有问题，请检查 camera 对象的合法性");var t={type:this.type};return e(t,"name",this.name),e(t,"perspective",this.perspective?this.perspective.json():void 0),e(t,"orthographic",this.orthographic?this.orthographic.json():void 0),s(t,this.extensions),e(t,"extras",this.extras),t}},t.GLTFComponentType=g,t.GLTFDocument=E,t.GLTFExtensionBase=x,t.GLTFFilter=v,t.GLTFImage=class{constructor(){this.extensions=new Set}validate(){return(void 0===this.uri||void 0===this.bufferView)&&(void 0===this.bufferView||void 0!==this.mimeType)}json(){var t={};return e(t,"name",this.name),e(t,"bufferView",this.bufferView),e(t,"uri",this.uri),e(t,"mimeType",this.mimeType),s(t,this.extensions),e(t,"extras",this.extras),t}},t.GLTFMaterial=class{constructor(){this.emissiveFactor=[0,0,0],this.alphaMode=d.OPAQUE,this.alphaCutoff=.5,this.doubleSided=!1,this.extensions=new Set}validate(){return!1!==this.pbrMetallicRoughness.validate()&&(!1!==this.normalTexture.validate()&&(!1!==this.occlusionTexture.validate()&&((this.alphaMode!==d.MASK||void 0!==this.alphaCutoff)&&3===this.emissiveFactor.length)))}json(){if(!this.validate())throw new Error("[GLTFMaterial json()] 此 material 对象的属性不合法，请检查");var t={};return e(t,"name",this.name),e(t,"pbrMetallicRoughness",void 0!==this.pbrMetallicRoughness?this.pbrMetallicRoughness.json():void 0),e(t,"normalTexture",void 0!==this.normalTexture?this.normalTexture.json():void 0),e(t,"emissiveTexture",void 0!==this.emissiveTexture?this.emissiveTexture.json():void 0),e(t,"emissiveFactor",this.emissiveFactor),e(t,"alphaMode",void 0!==this.alphaMode&&this.alphaMode!==d.OPAQUE?this.alphaMode:void 0),e(t,"alphaCutoff",.5!==this.alphaCutoff&&void 0!==this.alphaCutoff?this.alphaCutoff:void 0),e(t,"alphaCutoff",!1!==this.doubleSided&&void 0!==this.doubleSided?this.doubleSided:void 0),s(t,this.extensions),e(t,"extras",this.extras),t}},t.GLTFMesh=class{constructor(){this.primitives=[],this.extensions=new Set}validate(){let t=!1;return this.primitives.every(t=>t.validate())&&(t=!0),t}json(){var t={primitives:this.primitives.map(t=>t.json())};return e(t,"weights",this.weights),e(t,"name",this.name),s(t,this.extensions),t}},t.GLTFNode=class{constructor(t){this.children=[],this.extensions=new Set,this.mesh=t.mesh,this.camera=t.camera,this.scale=t.scale,this.skin=t.skin,this.matrix=t.matrix,this.translation=t.translation,this.rotation=t.rotation,this.name=t.name,this.weights=t.weights}validateTransforms(){let t=!0;return void 0!==this.matrix&&(void 0===this.rotation&&void 0===this.scale&&void 0===this.translation||(t=!1)),16!==this.matrix.length&&(t=!1),3!==this.scale.length&&(t=!1),3!==this.translation.length&&(t=!1),t=4===this.rotation.length&&this.rotation.every(t=>1<t||t<-1),t}validate(){return!this.validateTransforms()&&(!(this.weights.length<1)&&((void 0===this.weights||void 0!==this.mesh)&&((void 0===this.skin||void 0!==this.mesh)&&!(this.children.length<1))))}json(){if(!this.validate())throw new Error("[GLTFNode json()] 当前 node 属性不合法，请检查属性");var t={};return e(t,"mesh",this.mesh),e(t,"rotation",this.rotation),e(t,"translation",this.translation),e(t,"scale",this.scale),e(t,"matrix",this.matrix),e(t,"weights",this.weights),e(t,"skin",this.skin),e(t,"camera",this.camera),e(t,"name",this.name),0!==this.children.length&&e(t,"children",this.children),s(t,this.extensions),e(t,"extras",this.extras),t}},t.GLTFNormalTextureInfo=class extends L{constructor(t,e,s){super(t,e),this.extensions=new Set,this.scale=s}validate(){return!0}json(){if(!this.validate())throw new Error("[GLTFNormalTextureInfo json()] 当前 normal textureinfo 属性不合法，请检查");var t=super.json();return e(t,"scale",this.scale),s(t,this.extensions),e(t,"extras",this.extras),t}},t.GLTFOcclusionTextureInfo=class extends L{constructor(t,e,s){super(t,e),this.extensions=new Set,this.strength=s}validate(){return 1<this.strength||this.strength<0}json(){if(!this.validate())throw new Error("[GLTFOcclusionTextureInfo json()] 当前 occlusion texture info 属性不合法，请检查");var t=super.json();return e(t,"strength",this.strength),s(t,this.extensions),e(t,"extras",this.extras),t}},t.GLTFOrthographicCamera=class{constructor(t){this.xmag=t.xmag,this.ymag=t.ymag,this.zfar=t.zfar,this.znear=t.znear}validate(){return!1}json(){if(!this.validate())throw new Error("[GLTFOrthographicCamera json()] 当前对象属性不合法，请检查");return{xmag:this.xmag,ymag:this.ymag,zfar:this.zfar,znear:this.znear}}},t.GLTFPbr=class{constructor(){this.baseColorFactor=[1,1,1,1],this.extensions=new Set}validate(){return 4===this.baseColorFactor.length&&!this.baseColorFactor.every(t=>t<0||1<t)&&(!(1<this.roughnessFactor||this.roughnessFactor<0)&&(!(1<this.metallicFactor||this.metallicFactor<0)&&(!1!==this.baseColorTexture.validate()&&!1!==this.metallicRoughnessTexture.validate())))}json(){if(!this.validate())throw new Error("[GLTFPbr json()] 此 pbr 对象属性有误，请检查");var t={};return e(t,"baseColorFactor",this.baseColorFactor),e(t,"baseColorTexture",void 0!==this.baseColorTexture?this.baseColorTexture.json():void 0),e(t,"metallicFactor",this.metallicFactor),e(t,"roughnessFactor",this.roughnessFactor),e(t,"metallicRoughnessTexture",void 0!==this.metallicRoughnessTexture?this.metallicRoughnessTexture.json():void 0),s(t,this.extensions),e(t,"extras",this.extras),t}},t.GLTFPerspectiveCamera=class{constructor(t){this.yfov=t.yfov,this.znear=t.znear,this.zfar=t.zfar,this.aspectRatio=t.aspectRatio}validate(){return!1}json(){if(!this.validate())throw new Error("[GLTFPerspectiveCamera json()] 当前对象属性有问题，请检查");var t={yfov:this.yfov,znear:this.znear};return e(t,"aspectRatio",this.aspectRatio),e(t,"zfar",this.zfar),t}},t.GLTFPrimitive=class{constructor(t){this.mode=b.TRIANGLES,this.extensions=new Set,this.attribute=new y({position:t.attribute.position,uv0:t.attribute.uv0,normal:t.attribute.normal}),this.indices=t.indices,this.material=t.material,t.mode!==b.TRIANGLES&&(this.mode=t.mode)}validate(){return!1!==this.attribute.validate()&&(!(this.indices<0)&&!(this.material<0))}json(){var t={attribute:this.attribute.json()};return this.mode!==b.TRIANGLES&&void 0!==this.mode&&e(t,"mode",this.mode),e(t,"indices",this.indices),e(t,"material",this.material),s(t,this.extensions),e(t,"extras",this.extras),t}},t.GLTFPrimitiveAttribute=y,t.GLTFPrimitiveMode=b,t.GLTFSampler=class{constructor(){this.extensions=new Set}validate(){return void 0!==this.magFilter||void 0!==this.minFilter||void 0!==this.wrapS||void 0!==this.wrapT}json(){var t={};return e(t,"magFilter",this.magFilter),e(t,"minFilter",this.minFilter),e(t,"wrapS",this.wrapS),e(t,"wrapT",this.wrapT),e(t,"name",this.name),s(t,this.extensions),e(t,"extras",this.extras),t}},t.GLTFScene=class{constructor(){this.nodes=[],this.extensions=new Set}validate(){return this.nodes.length<1}json(){var t={nodes:this.nodes};return e(t,"name",this.name),s(t,this.extensions),t}},t.GLTFSkin=class{constructor(){this.extensions=new Set}validate(){return 1<this.joints.length}json(){if(!this.validate())throw new Error("[GLTFSkin json()] 当前 skin 属性不合法，请检查");var t={};return e(t,"inverseBindMatrices",this.inverseBindMatrices),e(t,"skeleton",this.skeleton),e(t,"name",this.name),e(t,"joints",0!==this.joints.length?this.joints:void 0),s(t,this.extensions),e(t,"extras",this.extras),t}},t.GLTFTexture=class{constructor(){this.extensions=new Set}validate(){return void 0!==this.sampler||void 0!==this.source||void 0!==this.name}json(){var t={};return e(t,"name",this.name),e(t,"source",this.source),e(t,"sampler",this.sampler),s(t,this.extensions),e(t,"extras",this.extras),t}},t.GLTFTextureInfo=L,t.GLTFVersion=n,t.GLTFWrapMode=p,t.I3dm=class{constructor(t,e=!1){this.header=new V,function(t,e){const s=new I(e);if(i=t.header,(e=s).rewind(),i.magic=e.readChars(4),i.version=e.readUint32(),i.byteLength=e.readUint32(),i.featureTableJSONByteLength=e.readUint32(),i.featureTableBinaryByteLength=e.readUint32(),i.batchTableJSONByteLength=e.readUint32(),i.batchTableBinaryByteLength=e.readUint32(),i.gltfFormat=e.readUint32(),t.byteLength%8!=0)throw new Error("[I3dm 实例化错误] byteLength 未 8 字节对齐。");s.rewind(),s.skip(32);var i=JSON.parse(s.readChars(t.featureTableJSONByteLength)),e=s.readBytes(t.featureTableBinaryByteLength);t.featureTable=J.createFromJSON(i,e),0!==t.batchTableJSONByteLength&&(i=JSON.parse(s.readChars(t.batchTableJSONByteLength)),e=s.readBytes(t.batchTableBinaryByteLength),t.batchTable=M.createFromJSON(i,e))}(this,t),!0===e&&(this.buffer=t)}validate(){return!0}get magic(){return this.header.magic}get byteLength(){return this.header.byteLength}get version(){return this.header.version}get featureTableJSONByteLength(){return this.header.featureTableJSONByteLength}get featureTableBinaryByteLength(){return this.header.featureTableBinaryByteLength}get batchTableJSONByteLength(){return this.header.batchTableJSONByteLength}get batchTableBinaryByteLength(){return this.header.batchTableBinaryByteLength}get gltfFormat(){return this.header.gltfFormat}get sizeWithoutExternalData(){return 32+this.featureTableJSONByteLength+this.featureTableBinaryByteLength+this.batchTableJSONByteLength+this.batchTableBinaryByteLength}},t.I3dmFeatureTable=J,t.I3dmHeader=V,t.MIME=T,t.Pnts=class{constructor(t,e=!1){this.header=new D,function(t,e){const s=new I(e);if(i=t.header,(e=s).rewind(),i.magic=e.readChars(4),i.version=e.readUint32(),i.byteLength=e.readUint32(),i.featureTableJSONByteLength=e.readUint32(),i.featureTableBinaryByteLength=e.readUint32(),i.batchTableJSONByteLength=e.readUint32(),i.batchTableBinaryByteLength=e.readUint32(),t.byteLength%8!=0)throw new Error("[Pnts 实例化错误] byteLength 未 8 字节对齐。");s.rewind(),s.skip(28);var i=JSON.parse(s.readChars(t.featureTableJSONByteLength)),e=s.readBytes(t.featureTableBinaryByteLength);t.featureTable=z.createFromJSON(i,e),0!==t.batchTableJSONByteLength&&(i=JSON.parse(s.readChars(t.batchTableJSONByteLength)),e=s.readBytes(t.batchTableBinaryByteLength),t.batchTable=M.createFromJSON(i,e))}(this,t),!0===e&&(this.buffer=t)}validate(){return!0}get magic(){return this.header.magic}get byteLength(){return this.header.byteLength}get version(){return this.header.version}get featureTableJSONByteLength(){return this.header.featureTableJSONByteLength}get featureTableBinaryByteLength(){return this.header.featureTableBinaryByteLength}get batchTableJSONByteLength(){return this.header.batchTableJSONByteLength}get batchTableBinaryByteLength(){return this.header.batchTableBinaryByteLength}get sizeWithoutGLB(){return 28+this.featureTableJSONByteLength+this.featureTableBinaryByteLength+this.batchTableJSONByteLength+this.batchTableBinaryByteLength}},t.PntsFeatureTable=z,t.PntsHeader=D,t.Property=class{},t.Tile=class{constructor(){this.transform=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.extensions=new Set}validate(){return!0}toJson(){if(!this.validate())throw new Error("[Tile toJson()] 验证此对象失败！");void 0!==this.transform&&Object.defineProperty({},"transform",{value:this.transform})}},t.TileBoundingVolume=class{validate(){return(void 0===this.box?1:0)+(void 0===this.region?1:0)+(void 0===this.sphere?1:0)==2&&(12==this.box.length&&(6==this.region.length&&4==this.sphere.length))}},t.TileContent=class{constructor(){this.extensions=new Set}get url(){return this.uri}validate(){return!0}},t.TileHeaderBase=R,t.TileRefine=k,t.Tileset=class{constructor(t){this.extensions=new Set,this.extensionsUsed=[],this.extensionsRequired=[],this.root=t.root,this.geometricError=t.geometricError,this.uri=t.uri}get url(){return this.uri}set url(t){this.uri=t}},t.TilesetExtBase=F,t.VctrFeatureTable=class i extends U{constructor(){super()}static createFromJSON(t,e){const s=new i;return s._json=t,s._binary=e,s.featureTableType=C.Vctr,t=s,e=t._json,t.region=e.REGION,t.rtcCenter=e.RTC_CENTER,t.polygonsLength=e.POLYGONS_LENGTH,t.polylinesLength=e.POLYLINES_LENGTH,t.pointsLength=e.POINTS_LENGTH,t.polygonCounts=e.POLYGON_COUNTS,t.polygonIndexCounts=e.POLYGON_INDEX_COUNTS,t.polygonMinimumHeights=e.POLYGON_MINIMUM_HEIGHTS,t.polygonMaximumHeights=e.POLYGON_MAXIMUM_HEIGHTS,t.polylineCounts=e.POLYLINE_COUNTS,t.polylineBatchIds=e.POLYLINE_BATCH_IDS,t.pointBatchIds=e.POINT_BATCH_IDS,void 0!==e.extensions&&(t.extensions=new Set),t.extras=e.extras,s}validate(){return 6===(t=this).region.length&&3===t.rtcCenter.length&&(void 0===t.polygonsLength||void 0!==t.polygonCounts&&void 0!==t.polygonIndexCounts)&&(void 0===t.polylinesLength||void 0!==t.polylineCounts);var t}},t.readGLB=t=>{const e=new I(t);if("gltf"!==e.readChars(4))throw new Error("[readGLB()] 不是 glb 二进制");if(2!==e.readUint32())throw new Error("[readGLB()] 暂不支持其他版本，仅支持 2.0 版本");if(e.readUint32()!==t.byteLength)throw new Error("[readGLB()] 数据长度异常");var s=e.readUint32(),i=e.readUint32();console.log(`数据块 1 的类型: ${i} (1=json, 0=bin)`);t=e.readChars(s),i=JSON.parse(t),s=e.readUint32(),t=e.readUint32();console.log(`数据块 2 的类型: ${t} (1=json, 0=bin)`);let r=void 0;try{r=e.readBytes(s)}catch{throw new Error("[readGLB()] 数据长度异常，试检查 glb binary 块有无问题")}if(r)return w(i,r)},t.readGLTF=w,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ts-3dtiles.umd.js.map
